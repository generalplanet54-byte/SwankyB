---
import Layout from '../../layouts/Layout.astro';
import { launchArticles } from '../../data/launchArticles';
import { launchProducts } from '../../data/launchProducts';
import { slugify } from '../../lib/slugify';

export function getStaticPaths() {
  // Get unique categories from articles
  const articleCategories = [...new Set(launchArticles.map(a => a.category))];
  
  // Get unique categories from products
  const productCategories = [...new Set(launchProducts.map(p => p.category).filter(Boolean))];
  
  // Combine and deduplicate
  const allCategories = [...new Set([...articleCategories, ...productCategories])];
  
  return allCategories.map(category => ({
    params: { slug: slugify(category) },
    props: { category }
  }));
}

const { category } = Astro.props;
const { slug } = Astro.params;

// Filter articles and products for this category
const categoryArticles = launchArticles.filter(article => slugify(article.category) === slug);
const categoryProducts = launchProducts.filter(product => product.category && slugify(product.category) === slug);
---

<Layout
  title={`${category} | SwankyBoyz`}
  description={`Discover the latest products, reviews, and insights in ${category}.`}
  canonical={`/category/${slug}`}
>
  <main class="bg-charcoal py-24">
    <div class="container space-y-16">
      <!-- Category Header -->
      <header class="max-w-3xl space-y-4">
        <p class="uppercase text-xs tracking-[0.5em] text-champagne/70">{category}</p>
        <h1 class="font-display text-4xl leading-tight text-off-white sm:text-5xl">
          {category}
        </h1>
        <p class="text-base text-off-white/70">
          Discover the latest products, reviews, and insights in {category.toLowerCase()}.
        </p>
      </header>

      <!-- Articles Section -->
      <section class="space-y-8">
        <h2 class="font-display text-3xl text-off-white">Latest Articles</h2>
        {categoryArticles.length > 0 ? (
          <div class="grid gap-10 lg:grid-cols-2">
            {categoryArticles.map((article) => (
              <article class="flex h-full flex-col overflow-hidden rounded-3xl border border-off-white/10 bg-[#161616]">
                <img
                  src={article.featuredImage}
                  alt={article.title}
                  loading="lazy"
                  class="h-64 w-full object-cover"
                />
                <div class="flex flex-1 flex-col gap-6 p-8">
                  <div class="space-y-3">
                    <p class="text-xs uppercase tracking-[0.3em] text-champagne/80">{article.category}</p>
                    <h3 class="font-display text-2xl text-off-white">{article.title}</h3>
                    <p class="text-sm text-off-white/70">{article.excerpt}</p>
                  </div>
                </div>
              </article>
            ))}
          </div>
        ) : (
          <div class="text-center py-12 rounded-3xl border border-off-white/10 bg-[#161616]">
            <p class="text-xl text-off-white/70">
              No articles found in this category. Check back soon for new content!
            </p>
          </div>
        )}
      </section>
    </div>
  </main>
</Layout>
