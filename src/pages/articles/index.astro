---
import Layout from '../../layouts/Layout.astro';

export const prerender = false;

const runtime = Astro.locals.runtime;
let articles = [];

// Fetch articles from D1 database
if (runtime && runtime.env && runtime.env.DB) {
  try {
    const result = await runtime.env.DB.prepare(
      'SELECT id, title, slug, category, excerpt, date, cover_image FROM articles ORDER BY date DESC'
    ).all();
    articles = result.results || [];
  } catch (error) {
    console.error('Database error:', error);
  }
}

// Group articles by category
const articlesByCategory = articles.reduce((acc, article) => {
  const category = article.category || 'Uncategorized';
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(article);
  return acc;
}, {});

const articleListStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: 'SwankyBoyz Journal',
  description: 'A curated archive of grooming, style, and lifestyle intelligence for modern gentlemen.',
  itemListElement: articles.map((article, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    name: article.title,
    url: `https://swankyboyz.com/articles/${article.slug}`,
  })),
};
---
<Layout
  title="Journal | SwankyBoyz"
  description="Premium grooming, wardrobe, and lifestyle strategy direct from the SwankyBoyz editorial desk."
  canonical="/articles"
  structuredData={articleListStructuredData}
>
  <main class="bg-charcoal py-24">
    <div class="container space-y-16">
      <header class="max-w-3xl space-y-4">
        <p class="uppercase text-xs tracking-[0.5em] text-champagne/70">SwankyBoyz Journal</p>
        <h1 class="font-display text-4xl leading-tight text-off-white sm:text-5xl">
          Intelligence engineered to sharpen your presence and expand your playbook.
        </h1>
        <p class="text-base text-off-white/70">
          From boardroom grooming rituals to executive travel essentials, every feature is field-tested by our editorial team before earning a byline. No guessworkâ€”just vetted strategies that command respect.
        </p>
      </header>

      {/* Articles by Category */}
      {Object.entries(articlesByCategory).map(([category, categoryArticles]) => (
        <div class="space-y-8">
          <h2 class="text-3xl font-display text-off-white border-b border-champagne/30 pb-4">
            {category}
          </h2>
          <div class="grid gap-10 lg:grid-cols-2">
            {categoryArticles.map((article) => (
              <article class="flex h-full flex-col overflow-hidden rounded-3xl border border-off-white/10 bg-[#161616]">
                {article.cover_image && (
                  <img
                    src={article.cover_image}
                    alt={article.title}
                    loading="lazy"
                    class="h-64 w-full object-cover"
                  />
                )}
                <div class="flex flex-1 flex-col gap-6 p-8">
                  <div class="space-y-3">
                    <p class="text-xs uppercase tracking-[0.3em] text-champagne/80">{article.category || 'Uncategorized'}</p>
                    <h3 class="font-display text-2xl text-off-white">{article.title}</h3>
                    <p class="text-sm text-off-white/70">{article.excerpt}</p>
                  </div>
                  <div class="mt-auto flex items-center justify-between text-xs uppercase tracking-[0.25em] text-off-white/50">
                    <span>{new Date(article.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                  </div>
                  <a
                    class="inline-flex items-center justify-center rounded-full border border-off-white/30 px-6 py-3 text-xs font-semibold uppercase tracking-[0.4em] text-off-white transition hover:border-champagne/80 hover:text-champagne"
                    href={`/articles/${article.slug}`}
                  >
                    Read feature
                  </a>
                </div>
              </article>
            ))}
          </div>
        </div>
      ))}
    </div>
  </main>
</Layout>
